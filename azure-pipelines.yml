trigger:
- main  # Trigger on push to the main branch, change to your branch name if different

pool:
  name: myUbuntuAgentPool  # Make sure the agent pool is set to the one where your personal agent is added

variables:
  azureSubscription: 'azureResourceManagerConnection'  # Use your actual AzureRM service connection name
  resourceGroup: 'OzResourceGroup'
  location: 'eastus'

jobs:
- job: DeployResources
  displayName: 'Deploy Resources (Network, Storage, and VM)'
  steps:
  - task: AzureCLI@2
    displayName: 'Login to Azure'
    inputs:
      azureSubscription: $(azureSubscription)
      scriptType: 'bash'
      scriptLocation: 'inlineScript'
      inlineScript: |
        az account show

  - task: AzureCLI@2
    displayName: 'Deploy Network Resources'
    inputs:
      azureSubscription: $(azureSubscription)
      scriptType: bash
      scriptLocation: inlineScript
      inlineScript: |
        az deployment group create --resource-group $(resourceGroup) --template-file network-setup.json --parameters @network-setup-parameters.json

  - task: AzureCLI@2
    displayName: 'Deploy Virtual Machine'
    inputs:
      azureSubscription: $(azureSubscription)
      scriptType: bash
      scriptLocation: inlineScript
      inlineScript: |
        az deployment group create --resource-group $(resourceGroup) --template-file linux-vm.json --parameters @linux-vm-parameters.json

  - task: AzureCLI@2
    displayName: 'Deploy Storage Account'
    inputs:
      azureSubscription: $(azureSubscription)
      scriptType: bash
      scriptLocation: inlineScript
      inlineScript: |
        az deployment group create --resource-group $(resourceGroup) --template-file storage-accounts.json --parameters @storage-accounts-parameters.json
